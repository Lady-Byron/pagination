{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@foskym/flarum-pagination/webpack/bootstrap","webpack://@foskym/flarum-pagination/webpack/runtime/compat get default export","webpack://@foskym/flarum-pagination/webpack/runtime/define property getters","webpack://@foskym/flarum-pagination/webpack/runtime/hasOwnProperty shorthand","webpack://@foskym/flarum-pagination/webpack/runtime/make namespace object","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['common/app']\"","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['common/extend']\"","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['forum/components/DiscussionComposer']\"","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['forum/utils/DiscussionControls']\"","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['forum/app']\"","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['forum/components/SettingsPage']\"","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['common/components/FieldSet']\"","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['common/utils/ItemList']\"","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['common/components/Switch']\"","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['common/utils/Stream']\"","webpack://@foskym/flarum-pagination/./node_modules/@babel/runtime/helpers/esm/extends.js","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['forum/states/DiscussionListState']\"","webpack://@foskym/flarum-pagination/./src/forum/overrideDiscussionListState.js","webpack://@foskym/flarum-pagination/./src/forum/utils/determineMode.ts","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['forum/components/DiscussionList']\"","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['forum/components/DiscussionListItem']\"","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['common/utils/classList']\"","webpack://@foskym/flarum-pagination/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['common/Component']\"","webpack://@foskym/flarum-pagination/external root \"flarum.core.compat['common/components/Button']\"","webpack://@foskym/flarum-pagination/./src/forum/components/Toolbar.tsx","webpack://@foskym/flarum-pagination/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@foskym/flarum-pagination/./src/forum/overrideDiscussionList.js","webpack://@foskym/flarum-pagination/./src/forum/index.js","webpack://@foskym/flarum-pagination/./src/forum/addUserPreference.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionComposer'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/utils/DiscussionControls'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/SettingsPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/FieldSet'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/ItemList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Switch'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/Stream'];","export default function _extends() {\n  _extends = Object.assign ? Object.assign.bind() : function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/states/DiscussionListState'];","import app from 'flarum/common/app';\nimport { override } from 'flarum/common/extend';\nimport DiscussionListState from 'flarum/forum/states/DiscussionListState';\nimport Stream from 'flarum/common/utils/Stream';\nimport determineMode from './utils/determineMode';\n\n// ---------- 调试日志 ----------\nconst DEBUG = false;\nfunction logWarn(context, error) {\n  if (DEBUG && console && console.warn) {\n    console.warn(`[foskym-pagination] ${context}:`, error);\n  }\n}\n\n// ---------- 路由/URL 工具 ----------\nfunction getPageFromURL() {\n  try {\n    const p = new URL(window.location.href).searchParams.get('page');\n    const n = parseInt(p, 10);\n    return Number.isFinite(n) && n > 0 ? n : null;\n  } catch (e) {\n    logWarn('getPageFromURL', e);\n    return null;\n  }\n}\n\n// 只改 page 参数，不重序列化整个 query，避免把 q 里的空格改成 +\nfunction setPageToURL(n, replace = true) {\n  try {\n    const { pathname, search, hash } = window.location;\n    let query = search || ''; // 原始 \"?q=...&page=...\"，保持原样（包括 %20 / + 等编码）\n\n    const re = /([?&])page=\\d+(&?)/;\n\n    if (re.test(query)) {\n      // 已存在 page=\n      if (n <= 1) {\n        // 删除 page 参数\n        query = query.replace(re, (match, sep, tail) => {\n          // 如果后面还有参数（tail 为 \"&\"），保留分隔符；否则干掉整个片段\n          return tail ? sep : '';\n        });\n        // 收尾清理\n        if (query === '?') query = '';\n        else if (query.endsWith('&')) query = query.slice(0, -1);\n      } else {\n        // 修改 page 数字\n        query = query.replace(re, (match, sep, tail) => {\n          return `${sep}page=${encodeURIComponent(String(n))}${tail ? '&' : ''}`;\n        });\n      }\n    } else if (n > 1) {\n      // 原来没有 page=，追加一个\n      query += (query ? '&' : '?') + 'page=' + encodeURIComponent(String(n));\n    }\n\n    const newUrl = pathname + query + (hash || '');\n\n    const mAny = (window && window.m) || null;\n    if (mAny && mAny.route && typeof mAny.route.set === 'function') {\n      // 使用 mithril 路由更新地址栏\n      mAny.route.set(newUrl, undefined, { replace });\n    } else {\n      // 退回原生 history\n      (replace ? history.replaceState : history.pushState).call(history, null, '', newUrl);\n    }\n  } catch (e) {\n    logWarn('setPageToURL', e);\n  }\n}\n\nfunction routeKey() {\n  try {\n    const mAny = (window && window.m) || null;\n    if (mAny?.route?.get) return String(mAny.route.get());\n  } catch (e) {\n    logWarn('routeKey', e);\n  }\n  return location.pathname + location.search + (location.hash || '');\n}\n\n// ---------- “从帖子返回”标记（用于每次回退都静默直出） ----------\nconst PENDING_BACK_KEY = 'lbtc:dl:pendingBack';\nif (!(window).__dlBackMarkerInstalled) {\n  (window).__dlBackMarkerInstalled = true;\n  document.addEventListener(\n    'click',\n    (ev) => {\n      const target = ev.target;\n      const a = target && target.closest?.('a[href*=\"/d/\"]');\n      if (a) {\n        try {\n          sessionStorage.setItem(\n            PENDING_BACK_KEY,\n            JSON.stringify({ t: Date.now(), base: routeKey() })\n          );\n        } catch (e) {\n          logWarn('setPendingBack', e);\n        }\n      }\n    },\n    { capture: true, passive: true }\n  );\n}\nfunction consumePendingBackForCurrentRoute() {\n  try {\n    const raw = sessionStorage.getItem(PENDING_BACK_KEY);\n    if (!raw) return false;\n    const obj = JSON.parse(raw);\n    const ok =\n      obj && obj.base === routeKey() && Date.now() - (obj.t || 0) < 10 * 60 * 1000;\n    if (ok) sessionStorage.removeItem(PENDING_BACK_KEY);\n    return !!ok;\n  } catch (e) {\n    logWarn('consumePendingBack', e);\n    return false;\n  }\n}\n\n// ---------- 会话级页面缓存 ----------\nconst CACHE_PREFIX = 'lbtc:dl:pagecache:';\nconst CACHE_MAX_AGE_MS = 30 * 60 * 1000; // 30 minutes\nconst CACHE_MAX_ENTRIES = 50;\n\nfunction buildSessionKey(state, page) {\n  try {\n    const req = state.requestParams ? state.requestParams() : {};\n    const base = location.pathname;\n    const keyObj = {\n      base,\n      include: req.include || [],\n      filter: req.filter || {},\n      sort: req.sort || null,\n      perPage: state.options?.perPage || 20,\n      page: Number(page) || 1,\n    };\n    return CACHE_PREFIX + JSON.stringify(keyObj);\n  } catch (e) {\n    logWarn('buildSessionKey', e);\n    return null;\n  }\n}\n\nfunction cleanupOldCacheEntries() {\n  try {\n    const now = Date.now();\n    const entries = [];\n\n    for (let i = 0; i < sessionStorage.length; i++) {\n      const key = sessionStorage.key(i);\n      if (key && key.startsWith(CACHE_PREFIX)) {\n        try {\n          const raw = sessionStorage.getItem(key);\n          const rec = raw ? JSON.parse(raw) : null;\n          if (rec && rec.ts) {\n            // Remove expired entries\n            if (now - rec.ts > CACHE_MAX_AGE_MS) {\n              sessionStorage.removeItem(key);\n            } else {\n              entries.push({ key, ts: rec.ts });\n            }\n          }\n        } catch {\n          // Invalid entry, remove it\n          sessionStorage.removeItem(key);\n        }\n      }\n    }\n\n    // If still too many entries, remove oldest ones\n    if (entries.length > CACHE_MAX_ENTRIES) {\n      entries.sort((a, b) => a.ts - b.ts);\n      const toRemove = entries.slice(0, entries.length - CACHE_MAX_ENTRIES);\n      toRemove.forEach((e) => sessionStorage.removeItem(e.key));\n    }\n  } catch (e) {\n    logWarn('cleanupOldCacheEntries', e);\n  }\n}\n\nfunction savePageCache(state, page, results) {\n  try {\n    const key = buildSessionKey(state, page);\n    if (!key) return;\n    const ids = Array.isArray(results) ? results.map((d) => d && d.id && d.id()) : [];\n    const total =\n      (state.totalDiscussionCount && state.totalDiscussionCount()) ||\n      (results &&\n        results.payload &&\n        results.payload.jsonapi &&\n        results.payload.jsonapi.totalResultsCount) ||\n      0;\n    const record = { ids, total, ts: Date.now(), perPage: state.options?.perPage || 20 };\n    sessionStorage.setItem(key, JSON.stringify(record));\n\n    // Periodically cleanup old entries (1 in 10 chance)\n    if (Math.random() < 0.1) {\n      cleanupOldCacheEntries();\n    }\n  } catch (e) {\n    logWarn('savePageCache', e);\n    // If storage is full, try to clean up and retry once\n    if (e.name === 'QuotaExceededError') {\n      cleanupOldCacheEntries();\n    }\n  }\n}\n\nfunction tryRestoreFromSession(state, page) {\n  try {\n    const key = buildSessionKey(state, page);\n    if (!key) return null;\n    const raw = sessionStorage.getItem(key);\n    if (!raw) return null;\n\n    const rec = JSON.parse(raw);\n    if (!rec || !Array.isArray(rec.ids) || !rec.ids.length) return null;\n\n    // Check if cache entry is expired\n    if (rec.ts && Date.now() - rec.ts > CACHE_MAX_AGE_MS) {\n      sessionStorage.removeItem(key);\n      return null;\n    }\n\n    const type = state.type || 'discussions';\n    const models = [];\n    for (const id of rec.ids) {\n      const model =\n        (app.store.getById && app.store.getById(type, id)) ||\n        (app.store.getBy && app.store.getBy(type, 'id', id)) ||\n        null;\n      if (!model) return null;\n      models.push(model);\n    }\n\n    const totalPages = Math.ceil(\n      (rec.total || 0) / (rec.perPage || state.options?.perPage || 20)\n    );\n    const links = {};\n    if (page > 1) links.prev = true;\n    if (page < totalPages) links.next = true;\n\n    const results = models;\n    results.payload = { jsonapi: { totalResultsCount: rec.total || 0 }, links };\n    return results;\n  } catch (e) {\n    logWarn('tryRestoreFromSession', e);\n    return null;\n  }\n}\n\nfunction invalidateSessionPage(state, page) {\n  try {\n    const key = buildSessionKey(state, page);\n    if (key) sessionStorage.removeItem(key);\n  } catch (e) {\n    logWarn('invalidateSessionPage', e);\n  }\n}\n\nexport default function () {\n  // 初始化分页选项\n  DiscussionListState.prototype.initOptions = function () {\n    this.options = {\n      cacheDiscussions: app.forum.attribute('foskym-pagination.cacheDiscussions'),\n      perPage: app.forum.attribute('foskym-pagination.perPage'),\n      perLoadMore: app.forum.attribute('foskym-pagination.perLoadMore'),\n      perIndexInit: app.forum.attribute('foskym-pagination.perIndexInit'),\n      leftEdges: 4,\n      rightEdges: 5,\n    };\n    this.usePaginationMode = determineMode();\n    this.lastTotalDiscussionCount = 0;\n    this.lastTotalPages = 0;\n    this.lastDiscussions = [];\n    this.lastLoadedPage = {};\n    this.lastRequestParams = {};\n    this.optionInitialized = true;\n\n    // “是否已处理过一次 refreshParams” 的标记（用于黄条/后续刷新）\n    this.__paramsRefreshedOnce = false;\n  };\n\n  /**\n   * 参数刷新：\n   * - 若检测到“从帖子返回”的标记 → 当作首次挂载处理：尊重 URL ?page，不绕过会话缓存（静默直出）\n   * - 否则：\n   *   - 第一次触发：同上（兼容冷启动/直接访问）\n   *   - 后续触发（黄条、切换排序/筛选）：回到第1页，绕过一次会话缓存（强制网络）\n   */\n  override(DiscussionListState.prototype, 'refreshParams', function (original, params, page = 1) {\n    const ret = original(params, page);\n    if (!this.usePaginationMode || typeof this.refresh !== 'function') return ret;\n\n    const back = consumePendingBackForCurrentRoute();\n    const first = !this.__paramsRefreshedOnce;\n\n    if (back || first) {\n      this.__paramsRefreshedOnce = true;\n      const goPage = getPageFromURL() ?? (page ?? 1);\n      return Promise.resolve(ret).then(() => this.refresh(goPage));\n    }\n\n    // 黄条/后续：强制到第1页 + 绕过一次会话缓存\n    const goPage = 1;\n    this.__bypassSessionOnce = true;\n    invalidateSessionPage(this, goPage);\n    return Promise.resolve(ret).then(() => this.refresh(goPage));\n  });\n\n  // 刷新指定页（含：会话缓存直出 + 首帧静默 + URL 同步；支持一次性绕过）\n  override(DiscussionListState.prototype, 'refresh', function (original, page = 1) {\n    if (!this.optionInitialized) this.initOptions();\n\n    if (!this.usePaginationMode) {\n      this.pageSize = this.options.perLoadMore;\n      return original(page);\n    }\n\n    let targetPage = page;\n    if (targetPage === undefined || targetPage === 1) {\n      const u = getPageFromURL();\n      if (u) targetPage = u;\n    }\n\n    if (!this.__bypassSessionOnce) {\n      const sessionResults = tryRestoreFromSession(this, targetPage);\n      if (sessionResults) {\n        this.silentRestoreOnce = true;\n\n        this.initialLoading = false;\n        this.loadingPrev = false;\n        this.loadingNext = false;\n        this.isRefreshing = false;\n\n        this.location = { page: targetPage };\n        setPageToURL(targetPage, true);\n\n        this.pages = [];\n        this.parseResults(this.location.page, sessionResults);\n\n        if (typeof m !== 'undefined' && m.redraw) m.redraw();\n        setTimeout(() => (this.silentRestoreOnce = false), 0);\n\n        return Promise.resolve(sessionResults);\n      }\n    }\n    this.__bypassSessionOnce = false;\n\n    this.initialLoading = true;\n    this.loadingPrev = false;\n    this.loadingNext = false;\n    this.isRefreshing = true;\n\n    this.clear();\n    this.location = { page: targetPage };\n    setPageToURL(targetPage, true);\n\n    return this.loadPage(targetPage)\n      .then((results) => {\n        this.pages = [];\n        this.parseResults(this.location.page, results);\n      })\n      .finally(() => {\n        this.initialLoading = false;\n        this.isRefreshing = false;\n      });\n  });\n\n  // 加载某页\n  override(DiscussionListState.prototype, 'loadPage', function (original, page = 1) {\n    const reqParams = this.requestParams();\n    if (!this.optionInitialized) this.initOptions();\n\n    if (!this.lastRequestParams['include']) {\n      this.lastRequestParams = reqParams;\n    }\n\n    const preloadedDiscussions = app.preloadedApiDocument();\n    if (preloadedDiscussions) {\n      this.initialLoading = false;\n      this.isRefreshing = false;\n      this.totalDiscussionCount = Stream(\n        preloadedDiscussions.payload.jsonapi.totalResultsCount\n      );\n      this.lastTotalDiscussionCount = this.totalDiscussionCount();\n      return Promise.resolve(preloadedDiscussions);\n    }\n\n    // 本地缓存复用（参数未变）\n    if (!this.isRefreshing && this.options.cacheDiscussions) {\n      const includeChanged =\n        JSON.stringify(reqParams['include']) !==\n        JSON.stringify(this.lastRequestParams['include']);\n      const filterChanged =\n        JSON.stringify(reqParams['filter']) !==\n        JSON.stringify(this.lastRequestParams['filter']);\n      const sortChanged = reqParams['sort'] !== this.lastRequestParams['sort'];\n\n      if (!(includeChanged || filterChanged || sortChanged)) {\n        if (this.lastLoadedPage[page]) {\n          const start = this.options.perPage * (page - 1);\n          const end = this.options.perPage * page;\n          const results = this.lastDiscussions.slice(start, end);\n          results.payload = {\n            jsonapi: { totalResultsCount: this.totalDiscussionCount() },\n          };\n\n          this.initialLoading = true;\n          m.redraw();\n          return new Promise((resolve) => setTimeout(() => resolve(results), 50));\n        }\n      }\n    }\n\n    const include = Array.isArray(reqParams.include)\n      ? reqParams.include.join(',')\n      : reqParams.include;\n\n    let newOffset, newLimit;\n    if (this.usePaginationMode) {\n      newOffset = this.options.perPage * (page - 1);\n      newLimit = this.options.perPage;\n    } else {\n      newOffset =\n        this.options.perIndexInit * Math.min(page - 1, 1) +\n        this.options.perLoadMore * Math.max(page - 2, 0);\n      newLimit =\n        newOffset === 0 ? this.options.perIndexInit : this.options.perLoadMore;\n    }\n\n    const params = {\n      ...reqParams,\n      page: { ...reqParams.page, offset: newOffset, limit: newLimit },\n      include,\n    };\n\n    return app.store.find(this.type, params);\n  });\n\n  // cards 兼容：拿所有 items\n  override(DiscussionListState.prototype, 'getAllItems', function (original) {\n    if (!('walsgit-discussion-cards' in flarum.extensions)) return original();\n    return this.extraDiscussions.concat(\n      this.getPages(true)\n        .map((pg) => pg.items)\n        .flat()\n    );\n  });\n\n  // cards 兼容：仅返回当前页（或所有页）\n  override(\n    DiscussionListState.prototype,\n    'getPages',\n    function (original, getAllPages = false) {\n      const allPages = original();\n      if (!('walsgit-discussion-cards' in flarum.extensions)) return allPages;\n      if (getAllPages) return allPages;\n      return [allPages.find((page) => page.number === this.location.page)];\n    }\n  );\n\n  // 解析结果并更新分页状态（保存会话缓存）\n  override(\n    DiscussionListState.prototype,\n    'parseResults',\n    function (original, pg, results) {\n      if (!this.usePaginationMode) return original(pg, results);\n\n      const pageNum = Number(pg);\n      const links = results.payload?.links || {};\n      const page = {\n        number: pageNum,\n        items: results,\n        hasNext: !!links?.next,\n        hasPrev: !!links?.prev,\n      };\n\n      this.hasPage = function (num) {\n        const all = this.getPages(true);\n        if (all.length === 0) return false;\n        return all.some((p) => p.number === num);\n      };\n\n      if (!this.hasPage(pageNum)) this.pages.push(page);\n      this.pages = this.pages.sort((a, b) => a.number - b.number);\n      this.location = { page: pageNum };\n\n      this.totalDiscussionCount = Stream(results.payload.jsonapi.totalResultsCount);\n\n      if (this.options.cacheDiscussions) {\n        if (\n          (this.lastTotalDiscussionCount !== this.totalDiscussionCount() &&\n            this.lastTotalDiscussionCount !== 0) ||\n          this.lastTotalDiscussionCount === 0 ||\n          this.isRefreshing\n        ) {\n          this.lastTotalDiscussionCount = this.totalDiscussionCount();\n          this.lastDiscussions = new Array(this.lastTotalDiscussionCount);\n          this.lastLoadedPage = {};\n        } else {\n          this.lastLoadedPage[pageNum] = page;\n          const start = this.options.perPage * (pageNum - 1);\n          const end = this.options.perPage * pageNum;\n          this.lastDiscussions.splice(start, end - start, ...results);\n        }\n      }\n\n      this.getTotalPages = function () {\n        return Math.ceil(this.totalDiscussionCount() / this.options.perPage);\n      };\n\n      this.page = Stream(page);\n      this.perPage = Stream(this.options.perPage);\n      this.totalPages = Stream(this.getTotalPages());\n\n      // 保存本页到会话缓存（供回退直出）\n      savePageCache(this, pageNum, results);\n\n      this.ctrl = {\n        scrollToTop: function () {\n          const container = document.querySelector('#content > .IndexPage > .container');\n          const header = document.querySelector('#header');\n          let offsetY = 0;\n          if (header) offsetY = header.clientHeight;\n          if (container) {\n            const target =\n              container.getBoundingClientRect().top + window.scrollY - offsetY;\n            setTimeout(() => window.scrollTo({ top: target, behavior: 'smooth' }), 50);\n          }\n        }.bind(this),\n\n        prevPage: function () {\n          let current = this.page().number - 1;\n          if (current < 1) return;\n          this.page(current);\n          this.loadingPrev = true;\n          this.loadPage(current).then((r) => {\n            this.parseResults(current, r);\n            this.loadingPrev = false;\n            setPageToURL(current, true);\n            this.ctrl.scrollToTop();\n          });\n        }.bind(this),\n\n        nextPage: function () {\n          let current = this.page().number + 1;\n          if (current > this.totalPages()) {\n            current = this.totalPages();\n            return;\n          }\n          this.page(current);\n          this.loadingNext = true;\n          this.loadPage(current).then((r) => {\n            this.parseResults(current, r);\n            this.loadingNext = false;\n            setPageToURL(current, true);\n            this.ctrl.scrollToTop();\n          });\n        }.bind(this),\n\n        toPage: function (page) {\n          const target = Number(page);\n          if (\n            this.page().number === target ||\n            target < 1 ||\n            target > this.totalPages()\n          )\n            return;\n          this.page(target);\n          this.initialLoading = true;\n          this.loadPage(target).then((r) => {\n            this.parseResults(target, r);\n            this.initialLoading = false;\n            setPageToURL(target, true);\n            this.ctrl.scrollToTop();\n          });\n        }.bind(this),\n\n        pageList: function () {\n          const p = [];\n          const left = Math.max(\n            parseInt(this.page().number) - this.options.leftEdges,\n            1\n          );\n          const right = Math.min(\n            parseInt(this.page().number) + this.options.rightEdges,\n            this.totalPages()\n          );\n          for (let i = left; i <= right; i++) p.push(i);\n          return p;\n        }.bind(this),\n      };\n\n      m.redraw();\n    }\n  );\n\n  // Realtime 兼容：静默插入新帖子，不强制刷新/跳转\n  // 与 Flarum 原生黄条机制配合：倒计时结束后自动调用 addDiscussion\n  override(\n    DiscussionListState.prototype,\n    'addDiscussion',\n    function (original, discussion) {\n      if (!this.usePaginationMode) return original(discussion);\n\n      // 1. 更新内部计数和缓存\n      const existingIdx = this.lastDiscussions.findIndex(\n        (d) => d && d.id && d.id() === discussion.id()\n      );\n\n      if (existingIdx !== -1) {\n        // 已存在：移动到开头（可能是编辑触发的更新）\n        this.lastDiscussions.splice(existingIdx, 1);\n      } else {\n        // 新讨论：增加计数\n        this.lastTotalDiscussionCount++;\n        if (this.totalDiscussionCount) {\n          this.totalDiscussionCount(this.lastTotalDiscussionCount);\n        }\n        if (this.totalPages) {\n          this.totalPages(Math.ceil(this.lastTotalDiscussionCount / (this.options?.perPage || 20)));\n        }\n      }\n\n      // 插入到缓存开头\n      this.lastDiscussions.unshift(discussion);\n\n      // 2. 使第 1 页的会话缓存失效（下次访问时重新获取）\n      invalidateSessionPage(this, 1);\n      if (this.lastLoadedPage) {\n        delete this.lastLoadedPage[1];\n      }\n\n      // 3. 如果用户当前在第 1 页且是默认排序（无筛选），静默插入到视图\n      const isOnFirstPage = this.location?.page === 1;\n      const params = this.getParams ? this.getParams() : {};\n      const hasSearchQuery = !!params.q;\n      const hasFilter = params.filter && Object.keys(params.filter).length > 0;\n      const sortParam = params.sort || '';\n      const isDefaultSort = !sortParam || sortParam === '-lastPostedAt' || sortParam === 'latest';\n\n      if (isOnFirstPage && !hasSearchQuery && !hasFilter && isDefaultSort) {\n        const page1 = this.pages?.find((p) => p.number === 1);\n        if (page1 && Array.isArray(page1.items)) {\n          // 检查是否已存在（避免重复）\n          const alreadyInView = page1.items.some(\n            (d) => d && d.id && d.id() === discussion.id()\n          );\n\n          if (!alreadyInView) {\n            // 插入到视图开头\n            page1.items.unshift(discussion);\n\n            // 保持每页数量不超限，移除末尾\n            const perPage = this.options?.perPage || 20;\n            if (page1.items.length > perPage) {\n              page1.items.pop();\n            }\n\n            // 更新 hasNext 状态（因为总数增加了）\n            if (this.lastTotalDiscussionCount > perPage) {\n              page1.hasNext = true;\n            }\n          }\n        }\n      }\n\n      // 4. 触发重绘\n      if (typeof m !== 'undefined' && m.redraw) {\n        m.redraw();\n      }\n    }\n  );\n\n  override(\n    DiscussionListState.prototype,\n    'deleteDiscussion',\n    function (original, discussion) {\n      if (!this.usePaginationMode) return original(discussion);\n      const index = this.lastDiscussions.indexOf(discussion);\n      if (index !== -1) {\n        this.lastDiscussions.splice(index);\n        this.lastTotalDiscussionCount--;\n        this.totalDiscussionCount(this.lastTotalDiscussionCount);\n      }\n      m.redraw();\n    }\n  );\n\n  // 清理状态\n  override(DiscussionListState.prototype, 'clear', function (original) {\n    if (!this.usePaginationMode) return original();\n    this.lastDiscussions = [];\n    this.lastLoadedPage = {};\n    this.lastRequestParams = {};\n    this.lastTotalDiscussionCount = 0;\n    this.lastTotalPages = 0;\n    this.totalDiscussionCount = Stream(0);\n    return original();\n  });\n}\n","import app from 'flarum/forum/app';\n\nexport default function () {\n  if (app.session.user === null) {\n    return app.forum.attribute('foskym-pagination.paginationOnLoading');\n  }\n\n  const preferences = app.session.user.preferences() as any;\n\n  if (app.forum.attribute('foskym-pagination.canUserPref')) {\n    if (!preferences['foskym-pagination.userCustom']) {\n      return app.forum.attribute('foskym-pagination.paginationOnLoading');\n    } else {\n      if (!preferences['foskym-pagination.userPaginationOnLoading']) {\n        return false;\n      }\n    }\n  } else {\n    return app.forum.attribute('foskym-pagination.paginationOnLoading');\n  }\n\n  return true;\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionListItem'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/classList'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","import Component from 'flarum/common/Component';\nimport Button from 'flarum/common/components/Button';\nimport type Mithril from 'mithril';\n\n// Extend KeyboardEvent to include Mithril's redraw property\ninterface MithrilKeyboardEvent extends KeyboardEvent {\n  redraw?: boolean;\n}\n\n// Type for pagination state\ninterface PaginationState {\n  page: () => { number: number; items: any[] };\n  totalPages: () => number;\n  ctrl: {\n    toPage: (page: number) => void;\n    pageList: () => number[];\n  };\n}\n\ninterface ToolbarAttrs {\n  state: PaginationState;\n}\n\nexport default class Toolbar extends Component<ToolbarAttrs> {\n  view(vnode: Mithril.Vnode<ToolbarAttrs>) {\n    const state = this.attrs.state;\n    return (\n      <div className=\"Pagination\">\n        <ul class=\"IndexPage-toolbar-view\">\n          <li>{this.buttonFirst()}</li>\n          <li>{this.buttonBack()}</li>\n          {state.ctrl.pageList().map((page: any) => {\n            return (\n              <li>\n                <Button\n                  title={page}\n                  className={state.page().number == page ? 'Button Button--primary Button--active' : 'Button'}\n                  onclick={() => {\n                    state.ctrl.toPage(page);\n                  }}\n                >\n                  {page}\n                </Button>\n              </li>\n            );\n          })}\n          <li>{this.buttonNext()}</li>\n          <li>{this.buttonLast()}</li>\n          <li>{this.inputJump()}</li>\n          <li>{this.buttonJump()}</li>\n        </ul>\n      </div>\n    );\n  }\n\n  buttonFirst() {\n    const state = this.attrs.state;\n    return Button.component({\n      title: 'First',\n      icon: 'fa fa-angle-double-left fas fa-angles-left',\n      className: 'Button Button--icon',\n      onclick: () => {\n        state.ctrl.toPage(1);\n      },\n      disabled: state.page().number === 1,\n    });\n  }\n\n  buttonBack() {\n    const state = this.attrs.state;\n    return Button.component({\n      title: 'Back',\n      icon: 'fa fa-angle-left fas',\n      className: 'Button Button--icon',\n      onclick: () => {\n        const page = state.page().number;\n        state.ctrl.toPage(page - 1);\n      },\n      disabled: state.page().number === 1,\n    });\n  }\n\n  buttonNext() {\n    const state = this.attrs.state;\n    return Button.component({\n      title: 'Next',\n      icon: 'fa fa-angle-right fas',\n      className: 'Button Button--icon',\n      onclick: () => {\n        const page = state.page().number;\n        state.ctrl.toPage(page + 1);\n      },\n      disabled: state.page().number === state.totalPages(),\n    });\n  }\n\n  buttonLast() {\n    const state = this.attrs.state;\n    return Button.component({\n      title: 'Last',\n      icon: 'fa fa-angle-double-right fas fa-angles-right',\n      className: 'Button Button--icon',\n      onclick: () => {\n        state.ctrl.toPage(state.totalPages());\n      },\n      disabled: state.page().number === state.totalPages(),\n    });\n  }\n\n  JumpFunc() {\n    const state = this.attrs.state;\n    const inputElement = document.getElementById('pagination-inputJump') as HTMLInputElement | null;\n    const inputValue = inputElement?.value;\n    const input = inputValue ? parseInt(inputValue, 10) : NaN;\n\n    if (Number.isFinite(input) && Number.isSafeInteger(input)) {\n      if (input !== state.page().number && input >= 1 && input <= state.totalPages()) {\n        state.ctrl.toPage(input);\n      }\n    }\n  }\n\n  inputJump() {\n    const state = this.attrs.state;\n    return m('input.FormControl', {\n      id: 'pagination-inputJump',\n      type: 'number',\n      min: 1,\n      max: state.totalPages(),\n      placeholder: state.page().number === undefined ? '' : `${state.page().number}`,\n      onkeydown: (event: MithrilKeyboardEvent) => {\n        event.redraw = false;\n        if (event.key === 'Enter' || event.keyCode === 13) {\n          event.redraw = true;\n          this.JumpFunc();\n        }\n      },\n    });\n  }\n\n  buttonJump() {\n    return Button.component({\n      title: 'Jump',\n      icon: 'fa fa-paper-plane fas',\n      className: 'Button Button--icon',\n      onclick: this.JumpFunc.bind(this),\n    });\n  }\n}\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","import app from 'flarum/common/app';\nimport { override } from 'flarum/common/extend';\nimport DiscussionList from 'flarum/forum/components/DiscussionList';\nimport DiscussionListItem from 'flarum/forum/components/DiscussionListItem';\nimport classList from 'flarum/common/utils/classList';\nimport Toolbar from './components/Toolbar';\n\n/**\n * 修复要点（仅此文件）：\n * - 绝不新建第二个 <ul.DiscussionList-discussions>。\n * - 深度遍历整棵 VDOM，原位找到现有的 UL，并只替换其 children（不改 attrs、不换节点）。\n * - 若同时存在其它“空壳”UL，就地删除（父级 children 中 splice 掉）。\n * - 工具条 Toolbar 仅作为 UL 的兄弟节点插入（上/下），不改动 UL 本体。\n * - 在 cards 模式下完全不触碰 UL，只插 Toolbar。\n * - 未找到 UL 时不做任何 UL 追加（避免制造第二个 UL）。\n *\n * 额外增强（与方案A匹配）：\n * - 若 state.silentRestoreOnce 为 true（回退命中缓存的首帧），移除该帧中的 LoadingIndicator，避免闪烁；\n *   仅影响该帧视觉，不改变任何数据/逻辑，下一帧自动恢复原状。\n */\nexport default function () {\n  override(DiscussionList.prototype, 'view', function (original) {\n    const state = this.attrs?.state;\n    const tree = original();\n\n    // 给根增加类（不影响结构）\n    tree.attrs = tree.attrs || {};\n    tree.attrs.className = classList(\n      'DiscussionList',\n      { 'DiscussionList--searchResults': state?.isSearchResults?.() },\n      tree.attrs.className\n    );\n\n    // --- [SilentRestore]：移除本帧 LoadingIndicator，避免“回退命中缓存”时的一闪 ---\n    if (state?.silentRestoreOnce) {\n      const getClass = (attrs) => String((attrs && (attrs.className || attrs.class)) || '');\n      const isLoadingIndicator = (n) => n && typeof n === 'object' && n.attrs && getClass(n.attrs).includes('LoadingIndicator');\n      const childrenRef = (nodeOrArr) => {\n        if (Array.isArray(nodeOrArr)) return nodeOrArr;\n        if (nodeOrArr && Array.isArray(nodeOrArr.children)) return nodeOrArr.children;\n        return null;\n      };\n      (function strip(node) {\n        if (!node) return;\n        if (Array.isArray(node)) {\n          for (let i = node.length - 1; i >= 0; i--) {\n            const child = node[i];\n            if (isLoadingIndicator(child)) node.splice(i, 1);\n            else strip(child);\n          }\n          return;\n        }\n        if (typeof node === 'string' || typeof node === 'number') return;\n        const ch = childrenRef(node);\n        if (!ch) return;\n        for (let i = ch.length - 1; i >= 0; i--) {\n          const c = ch[i];\n          if (isLoadingIndicator(c)) ch.splice(i, 1);\n          else strip(c);\n        }\n      })(tree);\n    }\n    // --- [SilentRestore] 结束 ---\n\n    // 非分页模式、加载中或空列表：不干预 UL，直接返回\n    if (!state?.usePaginationMode || state.isLoading?.() || state.isEmpty?.()) {\n      return tree;\n    }\n\n    const cardSupport = 'walsgit-discussion-cards' in flarum.extensions;\n\n    // 取当前页 items（用于生成 <li>）\n    const pageSize = state.options?.perPage || 0;\n    const pageNum = state.page || 1;\n    const params = state.getParams?.() || {};\n    const allPages = state.getPages ? state.getPages(true) : [];\n    let items = [];\n    if (Array.isArray(allPages) && allPages.length) {\n      const curr = allPages.find(p => p?.number === state.location?.page) || allPages[0];\n      if (curr && Array.isArray(curr.items)) items = curr.items;\n    }\n\n    const liChildren = items.length\n      ? items.map((discussion, itemNum) => (\n          <li\n            key={discussion.id()}\n            data-id={discussion.id()}\n            role=\"article\"\n            aria-setsize={-1}\n            aria-posinset={(pageNum * pageSize) + itemNum}\n          >\n            <DiscussionListItem discussion={discussion} params={params} />\n          </li>\n        ))\n      : null;\n\n    // 工具函数\n    const getClass = (attrs) => String((attrs && (attrs.className || attrs.class)) || '');\n    const isUlList = (n) => n && n.tag === 'ul' && getClass(n.attrs).includes('DiscussionList-discussions');\n    const childrenRef = (nodeOrArr) => {\n      if (Array.isArray(nodeOrArr)) return nodeOrArr;\n      if (nodeOrArr && Array.isArray(nodeOrArr.children)) return nodeOrArr.children;\n      return null;\n    };\n\n    // 深度收集所有 UL 以及其父引用\n    const uls = [];\n    (function walk(node, parent, indexInParent) {\n      if (!node) return;\n      if (Array.isArray(node)) {\n        for (let i = 0; i < node.length; i++) walk(node[i], node, i);\n        return;\n      }\n      if (typeof node === 'string' || typeof node === 'number') return;\n\n      if (isUlList(node)) uls.push({ node, parent, index: indexInParent });\n\n      const ch = childrenRef(node);\n      if (ch) for (let i = 0; i < ch.length; i++) walk(ch[i], node, i);\n    })(tree, null, null);\n\n    // cards 模式：不触碰 UL，只插 Toolbar\n    if (cardSupport) {\n      insertToolbars(position(), tree, uls.length ? uls[0] : null, state);\n      return tree;\n    }\n\n    // 非 cards：只原位替换 UL 的 children，并去除空壳 UL\n    if (uls.length > 0) {\n      // 选择要保留的 UL：优先已有 <li> 的；其次带 aria-busy 的；否则第一个\n      let keep = uls.find(e => {\n        const ch = childrenRef(e.node);\n        return ch && ch.some(c => c && c.tag === 'li');\n      }) || uls.find(e => e.node?.attrs && 'aria-busy' in e.node.attrs) || uls[0];\n\n      // 仅当我们生成了 liChildren 时才替换 children；否则保持原样\n      if (liChildren) {\n        const ch = childrenRef(keep.node);\n        if (ch) { ch.splice(0, ch.length, ...liChildren); }\n        else { keep.node.children = liChildren; }\n      }\n\n      // 删除其它空壳 UL（没有 <li> 的）\n      for (let i = uls.length - 1; i >= 0; i--) {\n        const e = uls[i];\n        if (e === keep) continue;\n        const parentArr = childrenRef(Array.isArray(e.parent) ? e.parent : e.parent);\n        if (!parentArr) continue;\n        const idx = e.index ?? parentArr.indexOf(e.node);\n        if (idx >= 0 && parentArr[idx] === e.node) {\n          const hasLi = (childrenRef(e.node) || []).some(c => c && c.tag === 'li');\n          if (!hasLi) parentArr.splice(idx, 1);\n        }\n      }\n\n      // 在保留的 UL 附近插入工具条\n      insertToolbars(position(), tree, keep, state);\n      return tree;\n    }\n\n    // 若未找到任何 UL：不追加 UL，避免制造第二个；只按需在根加 Toolbar\n    insertToolbars(position(), tree, null, state);\n    return tree;\n\n    function position() {\n      return app.forum.attribute('foskym-pagination.paginationPosition'); // 'above' | 'under' | 'both'\n    }\n\n    function insertToolbars(pos, rootTree, targetEntry, listState) {\n      const above = pos === 'above' || pos === 'both';\n      const under = pos === 'under' || pos === 'both';\n      if (!above && !under) return;\n\n      const toolbarVNode = Toolbar.component({ state: listState });\n\n      if (targetEntry && targetEntry.parent) {\n        const parent = targetEntry.parent;\n        const arr = childrenRef(Array.isArray(parent) ? parent : parent);\n        if (!arr) return;\n        let idx = targetEntry.index ?? arr.indexOf(targetEntry.node);\n        if (idx < 0) idx = 0;\n\n        if (above) arr.splice(idx, 0, toolbarVNode);\n        if (under) arr.splice(idx + (above ? 2 : 1), 0, toolbarVNode);\n      } else {\n        const rc = childrenRef(rootTree);\n        if (!rc) return;\n        if (above) rc.unshift(toolbarVNode);\n        if (under) rc.push(toolbarVNode);\n      }\n    }\n  });\n}\n","import app from 'flarum/common/app';\nimport { extend, override } from 'flarum/common/extend';\n\nimport DiscussionComposer from 'flarum/forum/components/DiscussionComposer';\nimport DiscussionControls from 'flarum/forum/utils/DiscussionControls';\n\nimport addUserPreference from './addUserPreference';\nimport overrideDiscussionListState from './overrideDiscussionListState';\nimport overrideDiscussionList from './overrideDiscussionList';\n\n\napp.initializers.add('foskym/flarum-pagination', () => {\n  addUserPreference();\n  overrideDiscussionListState();\n  overrideDiscussionList();\n\n  extend(DiscussionControls, 'deleteAction', function () {\n    if (!this.usePaginationMode) {\n      return;\n    }\n\n    if (app.discussions) {\n      let page = app.discussions.location.page;\n      app.discussions.refresh(page);\n    }\n  });\n\n  extend(DiscussionComposer.prototype, 'onsubmit', function () {\n    if (!this.usePaginationMode) {\n      return;\n    }\n\n    if (app.discussions) {\n      // let page = app.discussions.location.page;\n      app.discussions.refresh();\n    }\n  });\n}, -2); // load later to deal with `walsgit-discussion-cards`\n","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport SettingsPage from 'flarum/forum/components/SettingsPage';\nimport FieldSet from 'flarum/common/components/FieldSet';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Switch from 'flarum/common/components/Switch';\nimport Stream from 'flarum/common/utils/Stream';\n\nexport default function () {\n  extend(SettingsPage.prototype, 'oninit', function () {\n    const user = this.user;\n    const preferences = user.preferences();\n    this.userCustom = Stream(preferences['foskym-pagination.userCustom']);\n    this.userPaginationOnLoading = Stream(preferences['foskym-pagination.userPaginationOnLoading']);\n  });\n\n  extend(SettingsPage.prototype, 'settingsItems', function (items) {\n    if (Boolean(app.forum.attribute('foskym-pagination.canUserPref'))) {\n      items.add(\n        'pagination_settings',\n        FieldSet.component(\n          {\n            label: app.translator.trans('foskym-pagination.forum.user.settings.head'),\n            className: 'SettingsPage-pagination',\n          },\n          this.Pagination_UserPrefItems().toArray()\n        )\n      );\n    }\n  });\n\n  SettingsPage.prototype['Pagination_UserPrefItems'] = function () {\n    const items = new ItemList();\n    items.add(\n      'foskym-pagination.userCustom',\n      Switch.component(\n        {\n          state: this.user.preferences()['foskym-pagination.userCustom'],\n          onchange: (value) => {\n            this.UserCustom_Loading = true;\n            this.user.savePreferences({ 'foskym-pagination.userCustom': value }).then(() => {\n              this.UserCustom_Loading = false;\n              m.redraw();\n            });\n          },\n          loading: this.UserCustom_Loading,\n        },\n        app.translator.trans('foskym-pagination.forum.user.settings.userCustom')\n      )\n    );\n\n    if (this.user.preferences()['foskym-pagination.userCustom']) {\n      items.add(\n        'foskym-pagination.userPaginationOnLoading',\n        Switch.component(\n          {\n            state: this.user.preferences()['foskym-pagination.userPaginationOnLoading'],\n            onchange: (value) => {\n              this.userPaginationOnLoading_Loading = true;\n              this.user.savePreferences({ 'foskym-pagination.userPaginationOnLoading': value }).then(() => {\n                this.userPaginationOnLoading_Loading = false;\n                m.redraw();\n              });\n            },\n            loading: this.userPaginationOnLoading_Loading,\n          },\n          app.translator.trans('foskym-pagination.forum.user.settings.userPaginationOnLoading')\n        )\n      );\n    }\n\n    return items;\n  };\n}\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","_extends","assign","bind","target","i","arguments","length","source","apply","this","getPageFromURL","p","URL","window","location","href","searchParams","n","parseInt","Number","isFinite","e","setPageToURL","replace","pathname","search","hash","query","re","test","match","sep","tail","endsWith","slice","encodeURIComponent","String","newUrl","mAny","m","route","set","undefined","history","replaceState","pushState","routeKey","PENDING_BACK_KEY","__dlBackMarkerInstalled","document","addEventListener","ev","closest","sessionStorage","setItem","JSON","stringify","t","Date","now","base","capture","passive","CACHE_PREFIX","CACHE_MAX_AGE_MS","buildSessionKey","state","page","req","requestParams","keyObj","include","filter","sort","perPage","options","cleanupOldCacheEntries","entries","startsWith","raw","getItem","rec","parse","ts","removeItem","push","b","forEach","invalidateSessionPage","DiscussionListState","cacheDiscussions","app","perLoadMore","perIndexInit","leftEdges","rightEdges","usePaginationMode","preferences","determineMode","lastTotalDiscussionCount","lastTotalPages","lastDiscussions","lastLoadedPage","lastRequestParams","optionInitialized","__paramsRefreshedOnce","override","original","params","ret","refresh","back","ok","consumePendingBackForCurrentRoute","first","goPage","Promise","resolve","then","__bypassSessionOnce","initOptions","pageSize","targetPage","u","sessionResults","Array","isArray","ids","type","models","id","model","totalPages","Math","ceil","total","links","prev","next","results","payload","jsonapi","totalResultsCount","tryRestoreFromSession","silentRestoreOnce","initialLoading","loadingPrev","loadingNext","isRefreshing","pages","parseResults","redraw","setTimeout","clear","loadPage","reqParams","preloadedDiscussions","totalDiscussionCount","Stream","includeChanged","filterChanged","sortChanged","start","end","newOffset","newLimit","join","min","max","offset","limit","extensions","extraDiscussions","concat","getPages","map","pg","items","flat","getAllPages","allPages","find","number","pageNum","hasNext","hasPrev","hasPage","num","all","some","splice","getTotalPages","record","random","name","savePageCache","ctrl","scrollToTop","container","querySelector","header","offsetY","clientHeight","getBoundingClientRect","top","scrollY","scrollTo","behavior","prevPage","current","r","nextPage","toPage","pageList","left","right","discussion","existingIdx","findIndex","unshift","isOnFirstPage","getParams","hasSearchQuery","q","hasFilter","keys","sortParam","page1","pop","index","indexOf","_setPrototypeOf","setPrototypeOf","__proto__","Toolbar","subClass","superClass","create","constructor","view","vnode","attrs","className","class","buttonFirst","buttonBack","title","onclick","buttonNext","buttonLast","inputJump","buttonJump","Button","icon","disabled","JumpFunc","inputElement","getElementById","inputValue","input","NaN","isSafeInteger","placeholder","onkeydown","event","keyCode","Component","DiscussionList","tree","classList","isSearchResults","isLoadingIndicator","includes","strip","node","child","nodeOrArr","ch","children","c","isLoading","isEmpty","cardSupport","curr","liChildren","itemNum","role","childrenRef","uls","walk","parent","indexInParent","tag","insertToolbars","position","keep","parentArr","idx","pos","rootTree","targetEntry","listState","above","under","toolbarVNode","component","arr","rc","extend","SettingsPage","user","userCustom","userPaginationOnLoading","Boolean","add","FieldSet","label","Pagination_UserPrefItems","toArray","ItemList","Switch","onchange","UserCustom_Loading","savePreferences","loading","userPaginationOnLoading_Loading","overrideDiscussionListState","overrideDiscussionList","DiscussionControls","DiscussionComposer"],"sourceRoot":""}